## 실행 컨텍스트와 클로저

콜 스택: 함수를 호출할 때 해당 함수의 호출 정보(함수 내 지역 변수 혹은 인자값)이 쌓여있는 스택
실행 컨텍스트: 실행 가능한 코드를 형상화 하고 구분하는 추상적인 개념 즉 자바스크립트 코드 블록이 실행되는 환경
  - ecamscript에서는 실행 컨텍스트가 형성되는 경우
    - 전역 코드,
    - `eval()` 함수로 실행되는 코드,
    - 함수 안의 코드를 실행한 경우(대부분의 경우)

EcmaScript에서는 실행 컨텍스트 생성을 다음처럼 설명한다

> 현재 실행되는 컨텍스트에서 이 컨텍스트와 관련 없는 실행 코드가 실행되면, 새로운 컨텍스트가 생성되어 스택에 들어가고 제어권이 그 컨텍스트로 이동한다 

```
console.log("This is global context");

function ExContext1() {
  console.log("This is ExContext1");
};

function ExContext2() {
  ExContext1();
  console.log("This is Excontext2");
};

ExContext2();
> This is global context
> This is ExContext1
> This is Excontext2
```

전역 실행 컨텍스트가 가장 먼저 실행된다. 

1. 실행 컨텍스트가 생성되면 자바스크립트 엔진은 해당 컨텍스트에서 실행에 필요한 객체를 생성하는데, 이를 활성 객체라고 한다.
2. `arguments` 객체를 생성. 앞서 만들어진 활성 객체는 arguments 프로퍼티로 이 arugments 객체를 참조한다.
3. 현재 컨텍스트의 유효 범위를 나타내는 스코프 정보를 생성한다. 이 스코프 정보는 연결 리스트와 유사한 형식으로 만들어지는데, 이 리스트를 참조해서 상위 실행 컨텍스트의 변수도 접근이 가능하게 된다. 이 리스트를 스코프 체인이라고 하는데 `[[scope]]` 프로퍼티로 참조가능하다.
4. 변수 생성.
  - 현재 실행 컨텍스트 내부에서 사용되는 지역 변수의 생성이 이루어진다.
  - 활성 객체 == 변수 객체
  - 변수 객체 안에서 호출된 함수 인자(params)는 각각의 프로퍼티가 만들어지고 값이 할당된다.(만약 값이 주어지지 않는다면 undefined)
  - 변수나 내부 함수를 메모리에 생성하지만, 초기환느 표현식이 실행되기 전까지 이루어지지 않는다.
  - 마지막에는 `this`키워드를 사용하는 값이 할당된다.
5. 표현식 실행이 이루어 진다.

전역 실행 컨텍스트는 일반적인 실행 컨텍스트와는 다르다.
- arguments 객체가 없으며, 전역 객체 하나만을 포함하는 스포크 체인이 있다.
- ECMAScript에서 언급된 바에 의하면, 전역코드가 실행될 때 생성되는 컨텍스트가 전역 실행 컨텍스트 이다.
- 전역 실행 컨텍스트에서는 변수 객체가 곧 전역 객체이다. 따라서 전역적으로 선언된 함수와 변수가 전역 객체의 프로퍼티가 된다. 전역 실행 컨텍스트 역시, this를 전역 객체의 참조로 사용된다.
- 전역 객체의 스코프 체인은 자기 자신으로만 이루어져 있으며, 이는 `console.dir`에서 확인할 수 없다.

스코프 체인

- 자바스크립트에서는 함수 만이 유효 범위의 한 단위가 된다. 이 유효범위를 나타내는 스코프가 `[[scope]]`프로퍼티로 함수 객체 내에서 연결리스트 형식으로 관리되고, 이를 스코프 체인이라고 한다.
- 각각의 함수는 `[[scope]]` 프로퍼티로 자신이 생성된 실행 컨텍스트의 스코프 체인을 참조한다.
- 함수가 실행되는 순간 실행 컨텍스트가 만들어지고, 이 실행 컨텍스트는 실행된 함수의 `[[scope]]`프로퍼티를 기반으로 새로운 스코프 체인을 만든다.
- 스코프 체인 = 현재 실행 컨텍스트의 변수 객체 + 상위 컨텍스트의 스코프 체인
- 함수 객체가 선언될때의 실행 컨텍스트가 중요하다. 스코프 정보는 함수의 선언 될때(함수의 실행 컨텍스트)를 만들 때 생성됨
- `with`라는 명령어로 `[[scope]]`를 사용자가 임의로 수정할 수 있음.

 